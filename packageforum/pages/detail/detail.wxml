<view class="container">
  <!-- Â∏ñÂ≠êËØ¶ÊÉÖ -->
  <view class="post-detail">
    <view class="userinfo">
      <view class="userinfo-top">
        <!-- Â§¥ÂÉè -->
        <image class="avatar" src="{{post.avatarUrl}}"></image>
        <!-- ÊòµÁß∞ -->
        <text class="username">{{post.nickName}}</text>
      </view>
      <!-- Áî®Êà∑‰ø°ÊÅØ -->
      <view class="post-meta">
        <text class="post-author">Uid: {{post.userId}}</text>
        <text class="post-time">Êó∂Èó¥Ôºö{{post.formattedTime}}</text>
      </view>
    </view>
    <!-- Ê†áÈ¢ò -->
    <view class="post-title">{{post.title}}</view>
    <!-- ÊèèËø∞ -->
    <view class="post-description">{{post.description}}</view>
    <!-- ÂõæÁâá -->
    <view class="post-images" wx:if="{{post.images.length > 0}}">
      <image
        wx:for="{{post.images}}"
        wx:key="index"
        src="{{item}}"
        mode="aspectFill"
        class="post-image"
      ></image>
    </view>

    <!-- ÁÇπËµûÂíåËØÑËÆ∫ -->
    <view class="post-actions">
      <!-- ÁÇπËµûÊåâÈíÆ -->
      <button
        class="like-btn"
        bindtap="handleLike"
        data-post-id="{{post._id}}"
      >
        <text>üëç</text> {{post.likeCount || 0}}
      </button>
      <!-- ËØÑËÆ∫ÊåâÈíÆ -->
      <button
        class="comment-btn"
        bindtap="toggleCommentSection"
        data-post-id="{{post._id}}"
      >
        <text>üí¨</text> {{post.commentCount || 0}}
      </button>
    </view>
    <!-- ËØÑËÆ∫Âå∫Âüü -->
    <view class="comments-section">
      <view class="comment-list">
        <block wx:for="{{comments}}" wx:key="_id">
          <view class="comment-item" data-comment-id="{{item._id}}">
            <!-- Â§¥ÂÉè -->
            <image class="comment-avatar" src="{{item.avatarUrl}}"></image>
            <view class="comment-content-wrapper">
              <view class="comment-header">
                <!-- ÊòµÁß∞ -->
                <text class="comment-nickname">{{item.nickName}}</text>
              </view>
              <!-- ËØÑËÆ∫ÂÜÖÂÆπ -->
              <text class="comment-content">{{item.content}}</text>
              <view class="comment-footer">
                <!-- ËØÑËÆ∫Êó∂Èó¥ -->
                <text class="comment-time">{{item.formattedTime}}</text>
                <!-- ÂõûÂ§çÊåâÈíÆ -->
                <button class="reply-btn" bindtap="showReplyInput" data-comment-id="{{item._id}}" data-comment-author="{{item.nickName}}">
                  ÂõûÂ§ç
                </button>
              </view>
            </view>
          </view>
          <!-- ÂõûÂ§çÂàóË°® -->
          <view class="replies-list" wx:if="{{item.replies && item.replies.length > 0}}">
            <block wx:for="{{item.replies}}" wx:key="_id">
              <view class="reply-item">
                <!-- Â§¥ÂÉè -->
                <image class="comment-avatar" src="{{item.avatarUrl}}"></image>
                <view class="comment-content-wrapper">
                  <view class="comment-header">
                    <!-- ÊòµÁß∞ -->
                    <text class="comment-nickname">{{item.nickName}}</text>
                  </view>
                  <!-- ËØÑËÆ∫ÂÜÖÂÆπ -->
                  <text class="comment-content">{{item.content}}</text>
                  <view class="comment-footer">
                    <!-- ËØÑËÆ∫Êó∂Èó¥ -->
                    <text class="comment-time">{{item.formattedTime}}</text>
                    <!-- ÂõûÂ§çÊåâÈíÆ -->
                    <button class="reply-btn" bindtap="showReplyInput" data-comment-id="{{item._id}}" data-comment-author="{{item.nickName}}">
                      ÂõûÂ§ç
                    </button>
                  </view>
                </view>
              </view>
            </block>
          </view>
          <!-- ÂõûÂ§çËæìÂÖ•Ê°Ü -->
          <view class="reply-input" wx:if="{{showReplyInput && replyTargetId === item._id}}">
            <textarea
              placeholder="ÂõûÂ§ç {{replyTargetAuthor}}..."
              value="{{newReply}}"
              bindinput="onReplyInput"
              auto-height="{{true}}"
              style="min-height: 100rpx;"
            />
            <view class="reply-input-buttons">
              <button bindtap="hideReplyInput" class="cancel-btn">
                ÂèñÊ∂à
              </button>
              <button bindtap="handleReply" data-comment-id="{{item._id}}" class="submit-btn">
                ÂõûÂ§ç
              </button>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>
  
  <!-- ÂºπÂá∫ÂºèËØÑËÆ∫ËæìÂÖ•Ê°Ü -->
  <view class="comment-input-popup" wx:if="{{showCommentInput}}">
    <view class="comment-input-content">
      <textarea
        placeholder="ÂèëË°®ËØÑËÆ∫..."
        value="{{newComment}}"
        bindinput="onCommentInput"
        focus="{{true}}"
        auto-height="{{true}}"
        style="min-height: 120rpx;"
      />
      <view class="comment-input-buttons">
        <button bindtap="hideCommentInput" class="cancel-btn">
          ÂèñÊ∂à
        </button>
        <button bindtap="handleComment" data-post-id="{{post._id}}" class="submit-btn">
          ÂèëË°®
        </button>
      </view>
    </view>
  </view>
</view>